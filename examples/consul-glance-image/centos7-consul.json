{
    "min_packer_version": "0.12.0",
    "variables": {
        "identity_endpoint": "{{env `OS_AUTH_URL`}}",
        "region": "{{env `OS_REGION_NAME`}}",
        "ext_net_id": "",
        "consul_version": "1.0.1",
        "consul_sha256sum": "eac5755a1d19e4b93f6ce30caaf7b3bd8add4557b143890b1c07f5614a667a68",
        "fabio_version": "1.5.3",
        "fabio_sha256sum": "ad352a3e770215219c57257c5dcbb14aee83aa50db32ba34431372b570aa58e5"
    },
    "builders": [
        {
            "type": "openstack",
            "identity_endpoint": "{{user `identity_endpoint`}}",
            "region": "{{user `region`}}",
            "ssh_username": "centos",
            "image_name": "Centos 7 Consul",
            "source_image_name": "Centos 7",
            "ssh_ip_version": "4",
            "flavor": "s1-2",
            "networks": ["{{user `ext_net_id`}}"]
        }
    ],
    "provisioners": [{
        "type": "file",
        "source": "{{template_dir}}/../../modules",
        "destination": "/tmp"
    },{
        "type": "shell",
        "inline": [
            "/tmp/modules/install-consul/install-consul --version {{user `consul_version`}} --sha256sum {{user `consul_sha256sum`}}",
            "/tmp/modules/install-fabio/install-fabio --version {{user `fabio_version`}} --sha256sum {{user `fabio_sha256sum`}}",
            "/tmp/modules/install-dnsmasq/install-dnsmasq"
        ],
        "pause_before": "30s"
    }]
}
